#! /bin/sh

# Arg 1 is a make target. One of: all (default), system, base, top

# If arg 2, use it as path to prolog. Otherwise, assume xsb is on PATH
if test "$2" = "" ; then
   PROLOG=xsb
else
   PROLOG=$2
fi

# Generate the files that contain the Prolog & Flora installation directories
# Generates runflora file that can be used to run flora
rm -fr .makeflora.tmp
(echo "['flrconfig.P']." | $PROLOG) \
    || (echo "Usage:  makeflora all full-path-to-prolog"; touch .makeflora.tmp)
if test -f .makeflora.tmp ; then
    rm -rf .makeflora.tmp
    exit 1
fi

chmod 755 ./runflora

# Set PROLOG to the absolute path that was generated by flrconfig.P
if [ -d c:\  ]; then
    # It is CYGWIN
    PROLOG=`cat .prolog_path_cygwin`/xsb
    rm -f p2h/*.dll p2h/*.lib p2h/*.exp p2h/*.obj p2h/*.def p2h/*.a p2h/*.o
else
    PROLOG=`cat .prolog_path`/xsb
fi

make $1 PROLOG=$PROLOG

chmod a+r * */*

